<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
    </head>
    <body>
        <div id="signInandUp" class="">
            <a onclick="fnSignUp()">注册</a>
            <a onclick="fnSignIn()">登录</a>
        </div>
        <h1 id="totalScore">当前积分：</h1>
        <div id="div1" class="">
        </div>
        <div id="signUp" class="">
            <form class="">
                <label for="username">账号：</label>
                <input type="text" id="username">
                <br>
                <label for="password">密码：</label>
                <input type="text" id="password">
                <br>
                <label for="repassword">确认密码：</label>
                <input type="text" id="repassword">
                <br>
                <input type="submit" name="" value="提交">\
                <input id="signUpNone" type="button" name="" value="取消">
            </form>
        </div>
        <div id="signIn" class="">
            <form class="">
                <label for="username2">账号：</label>
                <input type="text" id="username2">
                <br>
                <label for="password2">密码：</label>
                <input type="text" id="password2">
                <br>
                <input type="submit" name="" value="登录">
                <input id="signInNone" type="button" name="" value="取消">
            </form>
        </div>
        <div class="box">
            <table id="tab" cellspacing="0" cellpadding="0">
                <caption>AJAX请求数据并动态绑定到表格</caption>
                <thead>
                    <tr>
                        <th id="thName" class="cursor">用户名</th>
                        <th id='thScore' class="cursor">分数</th>
                    </tr>
                </thead>
                <tbody id="tBody">
                </tbody>
            </table>
        </div>
        <script type="text/javascript" src="assets/bundle.js"></script>
        <script type="text/javascript">
        //注册
        function fnSignUp() {
            document.getElementById("signUp").style.display = "block";
            document.getElementById("signUpNone").onclick = function() {
                document.getElementById("signUp").style.display = "none";
            }
        }

        //登录
        function fnSignIn() {
            document.getElementById("signIn").style.display = "block";
            document.getElementById("signInNone").onclick = function() {
                document.getElementById("signIn").style.display = "none";
            }
        }

        //AJAX请求数据及动态绑定
        var utils = {
            listToArray : function (similarArray){
                /*
                *   try catch js
                * */
                var a = [];
                try{
                    a = Array.prototype.slice.call(similarArray);
                }catch (e){
                    alert(); //ie7 和 8 弹出
                    var a = [];
                    for(var i=0; i<similarArray.length; i++){
                        a[a.length] = similarArray[i];
                    }
                }
                return a;
            },
            jsonParse: function (jsonStr){
                return 'JSON' in window ? JSON.parse(jsonStr) : eval("(" + jsonStr+")");
            }

        }
        var tBody = document.getElementById("tBody");
        var xhr = new XMLHttpRequest();
        xhr.open('get','./data.txt',false);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && /^2\d{2}$/.test(xhr.status)) {
                var val = xhr.responseText;
                data = utils.jsonParse(val);
            }
        }
        xhr.send(null);
        function bind(){
            var frg = document.createDocumentFragment();
            for (var i = 0; i < data.length; i++) {
                var cur = data[i];
                var oTr = document.createElement("tr");
                for (var key in cur) {
                    var oTd = document.createElement("td");
                    oTd.innerHTML = cur[key];
                    oTr.appendChild(oTd);
                }
                frg.appendChild(oTr);
            }
            tBody.appendChild(frg);
            frg = null;
        }
        bind();

        //隔行变色
        function changeColor(){
            var oAllTr = tBody.getElementsByTagName("tr");
            for (var i = 0; i < oAllTr.length; i++) {
                oAllTr[i].className = "";
                i%2 == 1?oAllTr[i].className = "bg":null;
            }
        }
        changeColor();

        //升序降序
        var thScore = document.getElementById("thScore"),thName = document.getElementById("thName");
        thScore.index = 1;
        thName.index = 2;
        thName.flag = -1;
        thScore.flag = -1;
        var curIndex;
        function upOrder() {
            if (curIndex == undefined) {

            }else {
                if (curIndex == this.index) {

                }else {
                    if (curIndex == 1) {
                        thScore.flag = -1;
                    }else {
                        thName.flag = -1;
                    }
                }
            }
            curIndex = this.index;
            var oAllTr = tBody.rows;
            var ary = utils.listToArray(oAllTr);
            var _this = this;
            this.flag *= -1;
            if (this.index == 1) {
                ary.sort(function(a, b) {
                    return (parseFloat(a.cells[1].innerHTML) - parseFloat(b.cells[1].innerHTML))* _this.flag;
                });
            }else {
                ary.sort(function(a, b){
                    return a.cells[0].innerHTML.localeCompare(b.cells[0].innerHTML) * _this.flag;
                })
            }

            var frg = document.createDocumentFragment();
            for (var i = 0; i < ary.length; i++) {
                frg.appendChild(ary[i]);
            }
            tBody.appendChild(frg);
            frg = null;
            changeColor();
        }
        thName.onclick = function () {
            upOrder.call(this);
        }
        thScore.onclick = function (){
            //upOrder.call(thScore);
            upOrder.call(this);
        }
        </script>
    </body>
</html>
